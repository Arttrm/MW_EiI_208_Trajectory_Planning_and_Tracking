% ======================================================================= %
% Arthur RODRIGUEZ
% Student ID: 32448139
% Mail: ar4n20@soton.ac.uk
% ======================================================================= %
% ELEC6259
% Project
% RC Car Modelling and Trajectory Tracking Control
% ======================================================================= %
% Track_Data
% Version : 8.1
% Date : 19/07/2021
% ======================================================================= %

figure(1)
hold on

%% O-shape

if Track_Param.NTrack==1
    
rTrack=50;

t=linspace(3*pi/2,7*pi/2,min(ceil(2*pi*rTrack*10),200));
X=[rTrack*cos(t)]; 
Y=[rTrack+rTrack*sin(t)]; 

figure(1)
plot(X,Y,'k')

clear rTrack

end

%% Oval-shape

if Track_Param.NTrack==2
    
rTrack=20;

t=linspace(-pi/2,pi/2,2*ceil(pi*rTrack));
X=[linspace(0,25,51),25+rTrack*cos(t)    ,linspace(25,-25,101),-25+rTrack*cos(t+pi)   ,linspace(-25,0,51)]; 
Y=[zeros(1,51)      ,rTrack+rTrack*sin(t),2*rTrack*ones(1,101),rTrack+rTrack*sin(t+pi),zeros(1,51)]; 

[X,Y]=Delete_Double(X,Y);

figure(1)
plot(X,Y,'k')

clear rTrack

end

%% Test track

if Track_Param.NTrack==5
    
X=[linspace(0,50,101), 50+20*cos(linspace(pi/2,0,2*ceil(pi*14/2))),70*ones(1,61)       , 63+7*cos(linspace(2*pi,pi,2*ceil(pi*7)))]; 
Y=[zeros(1,101)      ,-20+20*sin(linspace(pi/2,0,2*ceil(pi*14/2))),linspace(-20,-50,61),-50+7*sin(linspace(2*pi,pi,2*ceil(pi*7)))]; 

X=[X, 49+7*cos(linspace(0,pi,2*ceil(pi*7))), 35+7*cos(linspace(2*pi,pi,2*ceil(pi*7))), 21+7*cos(linspace(0,pi/2,2*ceil(pi*7/2)))];
Y=[Y,-50+7*sin(linspace(0,pi,2*ceil(pi*7))),-50+7*sin(linspace(2*pi,pi,2*ceil(pi*7))),-50+7*sin(linspace(0,pi/2,2*ceil(pi*7/2)))];

X=[X,linspace(21,10,22), 10+13*cos(linspace(3*pi/2,5*pi/4,2*ceil(pi*13/4))),linspace(10-13*sqrt(2)/2,23-3/2*13*sqrt(2),20)];
Y=[Y,-43*ones(1,22)    ,-30+13*sin(linspace(3*pi/2,5*pi/4,2*ceil(pi*13/4))),linspace(-30-13*sqrt(2)/2,-43+13*sqrt(2)/2,20)];

X=[X, 23-2*13*sqrt(2)+13*cos(linspace(pi/4,pi/2,2*ceil(pi*13/4))),linspace(-13.7696,-20,20)];
Y=[Y,             -43+13*sin(linspace(pi/4,pi/2,2*ceil(pi*13/4))),-30*ones(1,20)];

X=[X,-20+10*cos(linspace(3*pi/2,pi,2*ceil(pi*10/2))),-10+20*cos(linspace(pi,pi/2,2*ceil(pi*20/2))),linspace(-10,0,20)];
Y=[Y,-20+10*sin(linspace(3*pi/2,pi,2*ceil(pi*10/2))),-20+20*sin(linspace(pi,pi/2,2*ceil(pi*20/2))),zeros(1,20)];

X=round(X,2);
Y=round(Y,2);

[X,Y]=Delete_Double(X,Y);

figure(1)
plot(X,Y,'k')

end

%% Test track 2

if Track_Param.NTrack==6
    
X=[linspace(0,50,101), 50+20*cos(linspace(pi/2,0,2*ceil(pi*14/2))),70*ones(1,61)       , 63+7*cos(linspace(2*pi,pi,2*ceil(pi*7)))]; 
Y=[zeros(1,101)      ,-20+20*sin(linspace(pi/2,0,2*ceil(pi*14/2))),linspace(-20,-50,61),-50+7*sin(linspace(2*pi,pi,2*ceil(pi*7)))]; 

X=[X, 49+7*cos(linspace(0,pi,2*ceil(pi*7))), 35+7*cos(linspace(2*pi,pi,2*ceil(pi*7))), 28*ones(1,53)];
Y=[Y,-50+7*sin(linspace(0,pi,2*ceil(pi*7))),-50+7*sin(linspace(2*pi,pi,2*ceil(pi*7))), linspace(-50,-24,53)];

X=[X, 21+7*cos(linspace(0,pi/2,2*ceil(pi*7/2))),linspace(21,10,22)];
Y=[Y,-24+7*sin(linspace(0,pi/2,2*ceil(pi*7/2))),-17*ones(1,22)];

X=[X, 10+13*cos(linspace(pi/2,3*pi/4,2*ceil(pi*13/4))),linspace(10-13*sqrt(2)/2,23-3/2*13*sqrt(2),20)];
Y=[Y,-30+13*sin(linspace(pi/2,3*pi/4,2*ceil(pi*13/4))),linspace(-30+13*sqrt(2)/2,-17-13*sqrt(2)/2,20)];

X=[X, 23-2*13*sqrt(2)+13*cos(linspace(7*pi/4,3*pi/2,2*ceil(pi*13/4))),linspace(23-2*13*sqrt(2),-20,13)];
Y=[Y,             -17+13*sin(linspace(7*pi/4,3*pi/2,2*ceil(pi*13/4))),-30*ones(1,13)];

X=[X,-20+10*cos(linspace(3*pi/2,pi,2*ceil(pi*10/2))),-10+20*cos(linspace(pi,pi/2,2*ceil(pi*20/2))),linspace(-10,0,20)];
Y=[Y,-20+10*sin(linspace(3*pi/2,pi,2*ceil(pi*10/2))),-20+20*sin(linspace(pi,pi/2,2*ceil(pi*20/2))),zeros(1,20)];

X=round(X,2);
Y=round(Y,2);

[X,Y]=Delete_Double(X,Y);

figure(1)
plot(X,Y,'k')

clear

end

%% Model'Club Thionville

if Track_Param.NTrack==10

% img = imread('MCT_Track.jpg');

% Track center
X=[173,264,352,429,504,573,600,596,583,560,517,481,430,435,467,491,550,507,415,346,292,305,351,344,313,255,210,213,165,130,116,133];
Y=[145,139,140,140,141,188,264,340,435,457,418,453,440,396,379,352,335,244,327,246,297,362,389,434,455,403,340,276,285,253,209,167];

% figure(1)
% image('CData',img)
% hold on
% plot(X,Y,'r+')

X=(X-X(1))/6.75;
Y=-(Y-Y(1))/6.75;

[X,Y]=Catmull_Rom(X,Y);

figure(1)
plot(X,Y,'k')

end

%% LMCC Track

if Track_Param.NTrack==11

% img = imread('LMCC_Track.jpg');

% Track center
X=[160,233,292,308,307,307,327,368,398,408,405,392,380,377,367,356,350,332,286,210,122,84 ,66 ,66 ,82 ,107,123,128,132,150,175,188,186,173,174,195,216,255,295,306,295,273,261,249,233,186,122,110,122];
Y=[208,208,208,202,186,166,165,179,177,153,135,121,127,140,147,139,102,75 ,62 ,63 ,65 ,81 ,111,137,156,157,143,121,107,100,101,109,120,133,147,149,131,107,100,116,135,133,137,160,178,181,181,195,208];

% figure(1)
% image('CData',img)
% hold on
% plot(X,Y,'r+')

X=(X-X(1))/4.7;
Y=-(Y-Y(1))/4.7;

[X,Y]=Catmull_Rom(X,Y);

figure(1)
plot(X,Y,'k')

end

%% AWS Track

if Track_Param.NTrack==20


AWS_track = [[5.0722947888590255, 1.1759856661360077], [5.303676205435295, 1.1785574568001176], [5.534803373967762, 1.1786600668147467], [5.765770862326377, 1.1771811842337423], [5.9967431953504615, 1.1757910074774716], [6.22785776775271, 1.1757222616744694], [6.459056249760877, 1.176512087485847], [6.690249693316957, 1.1772585050946243], [6.921371629610718, 1.1772961965919715], [7.152448219835691, 1.1768728212766535], [7.383527135500088, 1.1764722158890388], [7.614640545182624, 1.176452643440545], [7.845785735870632, 1.1766772421316782], [8.076924337813608, 1.1768933626582412], [8.308043948667944, 1.1769040209222725], [8.53915115717868, 1.1767852781716324], [8.77025759054294, 1.176669975133475], [9.0013764262508, 1.176660964055703], [9.232501075557224, 1.1767230242203583], [9.463625724863647, 1.1767846483651214], [9.694743010278557, 1.1767930296363824], [9.925858745400518, 1.1767644945567712], [10.156973317802766, 1.1767304365585256], [10.38809331623034, 1.1767186155747817], [10.619212927084675, 1.1767264639328412], [10.85033253793901, 1.1767454065748242], [11.081452536366584, 1.176765608829829], [11.312573309940632, 1.1767736025278526], [11.54368788234288, 1.1767637194102962], [11.774804780184553, 1.1767274813125896], [12.005917027147376, 1.1766971052601003], [12.23704012616085, 1.17670568031798], [12.46816361274756, 1.1767700174754057], [12.699286324187796, 1.176835953372436], [12.930403222029469, 1.1768256826816421], [13.16151430627258, 1.1767064070178004], [13.392622677503027, 1.1765799612490648], [13.623745001370025, 1.1765926058259384], [13.85487817728768, 1.176817010730453], [14.086014453791222, 1.177052849045474], [14.31712902619347, 1.1770313871774472], [14.548218793908518, 1.1766110640013745], [14.779307011330616, 1.1761699572104407], [15.010427784904664, 1.1762096350206301], [15.241602818731963, 1.1769972322858921], [15.472780177998686, 1.1778232477483217], [15.703896300693884, 1.1777439890212522], [15.934908553761431, 1.1762682554728026], [16.16591615595013, 1.1747281363202726], [16.397102816974552, 1.1754373468982495], [16.628322034150926, 1.177695736153183], [16.8595257483978, 1.1791019003055008], [17.09063101904235, 1.1768545084411814], [17.32172001161092, 1.1714123019334652], [17.552940779080245, 1.1669530780493675], [17.784233635171745, 1.1698715045277697], [18.014752895081187, 1.1868237641495585], [18.24256999437875, 1.2237810039983326], [18.46467426415552, 1.2853885800055027], [18.67751165782358, 1.373690020512463], [18.87754285657803, 1.4882597701044242], [19.061506044052063, 1.6272903325416421], [19.226419231756324, 1.7884745327879161], [19.370492606480013, 1.968393199741982], [19.492574300561273, 2.164171751147933], [19.589540473705824, 2.37339734981569], [19.658698267059492, 2.5934501944463477], [19.701101879828286, 2.82009595052687], [19.715221948017017, 3.0503062176727127], [19.70088096308291, 3.280525592789637], [19.65856494186579, 3.507121351922521], [19.588873072590843, 3.7265887671779296], [19.49270840090145, 3.9356982876610545], [19.371416581078222, 4.131612295913513], [19.22664479938055, 4.311502670021241], [19.060582844600333, 4.472324053270555], [18.87611503677107, 4.6106471976560215], [18.676121820193885, 4.723222689154412], [18.463086764174705, 4.808279511856952], [18.239924419459555, 4.867578410981622], [18.012365443938165, 4.913753111351326], [17.786471483045084, 4.9661088297127405], [17.57299536868163, 5.050292256124564], [17.38507118272031, 5.1793417418696635], [17.235843859084298, 5.352049221166737], [17.135684082462717, 5.558237408372179], [17.091032544916402, 5.783808520758413], [17.10490146564723, 6.0134220220118095], [17.17642655633557, 6.231800937829684], [17.300832914695377, 6.424335695024354], [17.47070548954673, 6.578837502849552], [17.672152880911028, 6.684299475146801], [17.893371933413334, 6.748585472905049], [18.121621564443956, 6.792572128562426], [18.348365085873628, 6.8411455196990385], [18.56811756124523, 6.911117604424703], [18.77677303968062, 7.008396161598682], [18.971281319800653, 7.1319874534400185], [19.148175171422622, 7.280027640249557], [19.30731429303455, 7.447432536297725], [19.44454622496983, 7.633185149409321], [19.55643319261179, 7.835210024897492], [19.64301627872362, 8.049759329555599], [19.703459100258783, 8.27293989021291], [19.736954729736794, 8.501369742798971], [19.742726470389698, 8.731943262961664], [19.720068163778762, 8.961526145929298], [19.669045697354363, 9.186698445454141], [19.590403211732504, 9.403845653523241], [19.48514142101243, 9.609273034463456], [19.354849375467893, 9.799640869687238], [19.20157036120702, 9.971897795095714], [19.0275716816692, 10.123127709649907], [18.835617509184317, 10.250914094213982], [18.628850287562045, 10.353252032430333], [18.410601596351967, 10.428325356108019], [18.184712286337742, 10.476530940242242], [17.954600753474153, 10.493487656956262], [17.724042736240953, 10.479035438502988], [17.497605397668906, 10.43760928543918], [17.278011827324683, 10.367964700099204], [17.068626160909844, 10.270846598245555], [16.8730078710376, 10.1479413110346], [16.694561401026192, 10.002156800467333], [16.53785236361341, 9.833421753068052], [16.4050410920251, 9.64523828061084], [16.29603534383074, 9.44204370909188], [16.207754686938642, 9.228691230591181], [16.135389337471395, 9.008978675263052], [16.07235907700266, 8.786192664161518], [16.012431727873377, 8.562581122064103], [15.951293599950137, 8.33942420337429], [15.887716086070043, 8.117043593879174], [15.822620060245413, 7.895170705325199], [15.757938737784912, 7.673206737060411], [15.69431936599517, 7.450970692382896], [15.631241821591459, 7.228624189332692], [15.567987543791446, 7.006331946535738], [15.50387052796475, 6.784331933959862], [15.438798531680847, 6.562534234613972], [15.373216489016386, 6.34078226891009], [15.308159220515506, 6.118866359726752], [15.244532097261015, 5.896631477768949], [15.181985528192683, 5.674152812244756], [15.118380884185967, 5.45188266112234], [15.053164710657711, 5.229925862962446], [14.988006673115082, 5.0078233372652585], [14.925239187301372, 4.784862143060366], [14.866436575707326, 4.560553356708681], [14.810457047575253, 4.335132235165354], [14.75231718621734, 4.1099423010582115], [14.683640758824652, 3.8878674868474974], [14.594487287001698, 3.6740514707547476], [14.476065834575422, 3.4764687659282174], [14.323633280265256, 3.3054607952775967], [14.138370947299109, 3.1717004537239504], [13.927067568505095, 3.0838253922249024], [13.700134136189035, 3.0457393453218984], [13.46875988971766, 3.0562828876749464], [13.246495164620569, 3.1183719265364047], [13.045234195983511, 3.231018343937258], [12.877462268079427, 3.3847238825460053], [12.74355300150927, 3.5719499522132736], [12.642496767989343, 3.7808089065983523], [12.57114453496493, 4.000661182078602], [12.517719114468008, 4.2258524726920825], [12.468331431959399, 4.451925298634265], [12.4120085139389, 4.675469402988355], [12.349562326339083, 4.897287643715842], [12.284753104710205, 5.119237853130699], [12.218900923499206, 5.341877555335074], [12.143529168428643, 5.5604917281081185], [12.047748194244377, 5.769001672792825], [11.923791033266838, 5.963310352695544], [11.773391300587377, 6.138089023373837], [11.600822378722711, 6.292222442836788], [11.41051035404513, 6.423863243247837], [11.20585734443344, 6.530585022353591], [10.989740306029631, 6.6098534387540155], [10.765270289211145, 6.659856006203924], [10.535845148551175, 6.680123761085937], [10.305042572605117, 6.671448127951038], [10.07649877348723, 6.63428179234063], [9.854723553389107, 6.569068719398274], [9.645882039799716, 6.473548194429611], [9.453854615972944, 6.348333552082991], [9.275504651697673, 6.202287429580409], [9.275504651697673, 6.202287429580409], [9.116978283374237, 6.03550982081714], [8.981847385959469, 5.850168616697161], [8.86767567408242, 5.651305563680538], [8.776009952533968, 5.440973249633089], [8.704624000637892, 5.220948310275531], [8.647611589827875, 4.994285016506012], [8.594817526134847, 4.767440338461341], [8.538167883875133, 4.545126779136325], [8.477873502889935, 4.325052230404367], [8.4162187398411, 4.10315647502938], [8.352330004651293, 3.8781240894432756], [8.27270114513999, 3.6597779235639645], [8.16076999414895, 3.460893554019279], [8.00484928070125, 3.293094689775188], [7.8126641145668145, 3.1637910528795956], [7.596837368517896, 3.07951751569005], [7.369572561083771, 3.045607279741219], [7.141216347412836, 3.0625313434099795], [6.921691765104896, 3.1295531237584555], [6.721092771557493, 3.2446898929968886], [6.5503727678223385, 3.4009024490924276], [6.420769246134228, 3.589775608125777], [6.338615540767208, 3.8027471021340062], [6.291051584127672, 4.030337277301015], [6.260565267052257, 4.262651970233193], [6.232437139340433, 4.491840109858431], [6.203227294722737, 4.718443523562755], [6.172330731375425, 4.9450992596541425], [6.139473435019582, 5.173789561455805], [6.105720456911868, 5.403828230550745], [6.072487214515647, 5.633872325671007], [6.040737214899352, 5.8629002037625355], [6.009647446293144, 6.091210877578064], [5.977947056051249, 6.319429696536304], [5.944827953973473, 6.548049847581979], [5.911302675142792, 6.7770463322412695], [5.8788529120461845, 7.0062645087924125], [5.848314466370326, 7.235533845010906], [5.8173328306973815, 7.464497385945009], [5.7848410159045045, 7.693243110719637], [5.751362439648943, 7.9219182971650355], [5.7198246363801815, 8.150972917809952], [5.691311842230135, 8.38053332152981], [5.664268532010084, 8.610419286769172], [5.63242202665765, 8.83964288934564], [5.586510100942974, 9.066038370008044], [5.518757066788638, 9.286364453771142], [5.42476183629617, 9.496503562559695], [5.303744805898333, 9.692340056164653], [5.156952992486794, 9.869833871158278], [4.988806475048662, 10.02763431480787], [4.802178527780171, 10.163063256042278], [4.599853476819547, 10.273360010690766], [4.385159994917089, 10.356918475257118], [4.16149923101851, 10.412311992654082], [3.9322957822503923, 10.439656447279674], [3.7015532801561477, 10.436941109177724], [3.4731400932192997, 10.404165978348232], [3.2508976535833654, 10.342092248629655], [3.03829968328278, 10.252175257528819], [2.8385312591833483, 10.136267605120992], [2.6553826537612366, 9.995669599617997], [2.493087620169625, 9.831413736124546], [2.353282589510563, 9.648060201353104], [2.238852947643955, 9.448010011510005], [2.150373271894402, 9.235126109053454], [2.085984470334907, 9.01360242398647], [2.040878793847547, 8.7869189764086], [2.0069854173345476, 8.55798760405321], [1.975739747393554, 8.328704315198166], [1.9417548067031944, 8.099952001678503], [1.9041570536327903, 7.8718310449627324], [1.8658437434726451, 7.643877132312326], [1.8292803264798287, 7.415636803039405], [1.7941794170987322, 7.187139512710019], [1.75846759540202, 6.958742603849142], [1.721170163144027, 6.7306216471333755], [1.6829858179786612, 6.502680524399807], [1.6455359240983647, 6.274662274591975], [1.609357125097116, 6.046450819525248], [1.5736006840314367, 5.818128906085832], [1.5370730691164347, 5.589931597442273], [1.498530509386307, 5.361881566628972], [1.4599266646379974, 5.13392920427151], [1.4233874225258702, 4.905767358579183], [1.3885265663187525, 4.677365411266223], [1.3528851376113025, 4.449023344018457], [1.3140176946148365, 4.221077376619419], [1.273015304439582, 3.99333972983554], [1.2352100059004947, 3.7650230486348306], [1.2080755190763206, 3.535484349016272], [1.1986911598299912, 3.3047862240577217], [1.211643954320671, 3.0744603631937935], [1.249573954548925, 2.8469869444645823], [1.3124083451927575, 2.6247891726442703], [1.3991961668672985, 2.410659803588999], [1.5085473881562415, 2.207281425462149], [1.6381871963887136, 2.0160958107072346], [1.7877813580940227, 1.8401116419203412], [1.9557086059730366, 1.681359609079369], [2.139876625903092, 1.5416542331890002], [2.338044372531634, 1.42274133789757], [2.547852978241906, 1.3262361346723746], [2.767012466560118, 1.2539872994096515], [2.9930838391026597, 1.2067647947923563], [3.2231342322880323, 1.1818476144599404], [3.4543352335222437, 1.1735013216836097], [3.6857278897224006, 1.1759530615374028], [3.916965710414175, 1.1799093606991848], [4.148126016458448, 1.1812030801659719], [4.379134006220383, 1.1782782102824962], [4.610082115917123, 1.1747784239478387], [4.8411090967676955, 1.1738637511073302], [5.0722947888590255, 1.1759856661360077]]

X=AWS_track(1:2:end)*5
Y=AWS_track(2:2:end)*5

X=(X-X(1));
Y=-(Y-Y(1));

X2=[0];
Y2=[0];

for i=2:length(X)
    X2=[X2,(X(i-1)+X(i))/2,X(i)];
    Y2=[Y2,(Y(i-1)+Y(i))/2,Y(i)];
end

X=X2;
Y=Y2;

[X,Y]=Delete_Double(X,Y);

figure(1)
plot(X,Y,'k')

clear AWS_track X2 Y2

end

%% Track sides

Track_Param.xTrack=X(1:end-1);
Track_Param.yTrack=Y(1:end-1);

Track_Param.lHalfTrackWidth=2.5;

X=Track_Param.xTrack;
Y=Track_Param.yTrack;

X=[X(end),X,X(1)];
Y=[Y(end),Y,Y(1)];

RightSide=[];
LeftSide =[];

for i=2:length(X)-1
    
    A=[X(i+1)-X(i-1);Y(i+1)-Y(i-1);0];
    B=[0;0;1];
    
    R=cross(A,B);
    L=cross(A,-B);
    
    RightSide=[RightSide,Track_Param.lHalfTrackWidth*R/norm(R)+[X(i);Y(i);0]];
    LeftSide =[LeftSide ,Track_Param.lHalfTrackWidth*L/norm(L)+[X(i);Y(i);0]];

end

Track_Param.xRightSide=RightSide(1,:);
Track_Param.yRightSide=RightSide(2,:);
Track_Param.xLeftSide =LeftSide(1,:);
Track_Param.yLeftSide =LeftSide(2,:);

clear A B R L RightSide LeftSide

%% End

Track_Param.xStartLine=[X(1),X(1)];
Track_Param.yStartLine=Y(1)+1.5*[-Track_Param.lHalfTrackWidth,Track_Param.lHalfTrackWidth];

lTrack=0;
for i=2:length(X)
    lTrack=lTrack+sqrt((X(i)-X(i-1))^2+(Y(i)-Y(i-1))^2);
end
Track_Param.lTrack=lTrack;

clear X Y P_X P_Y lTrack i t
 